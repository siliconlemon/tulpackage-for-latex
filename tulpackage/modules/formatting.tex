% tulpackage/modules/formatting.tex
% Obsahuje: Stylování obsahu, seznamů, titulků a prostředí pro výpisy kódu

% ==========================================================================
% Obecná pomocná makra
% ==========================================================================

\providecommand{\oddel}{{\color{\tulcolor}\rule{1pt}{1.7ex}}}%
\providecommand{\TUL@headfnt}{\TULHeadFont}%
\providecommand{\TUL@TOCtextcolor}{black}%

% ==========================================================================
% Obsah (TOC) a seznamy (LOF, LOT)
% ==========================================================================

\renewcommand{\cfttoctitlefont}{\color{\titlecolor}\TUL@headfnt\LARGE\raggedright}%
\renewcommand{\cftpartfont}{\color{\TUL@TOCtextcolor}}%
\renewcommand{\cftloftitlefont}{\color{\TUL@TOCtextcolor}\LARGE\bfseries}%
\renewcommand{\cftfigfont}{\color{\TUL@TOCtextcolor}}%
\renewcommand{\cfttabfont}{\color{\TUL@TOCtextcolor}}%

% Délka pro odsazení v TOC
\ifcsdef{TUL@TOC@skip}{}{%
    \newlength{\TUL@TOC@skip}%
}%

\@ifundefined{chapter}{%
    \setlength{\cftbeforetoctitleskip}{2mm}%
    \setlength{\cftaftertoctitleskip}{10mm}%
    \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}%
    \setlength{\TUL@TOC@skip}{8pt}%
}{%
    \setlength{\cftbeforetoctitleskip}{0mm}%
    \setlength{\cftaftertoctitleskip}{6mm}%
    \renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}%
    \setlength{\TUL@TOC@skip}{4pt}%
    \renewcommand{\cftbeforechapskip}{\TUL@TOC@skip}%
}%

\renewcommand{\cftbeforesecskip}{\TUL@TOC@skip}%
\renewcommand{\cftbeforesubsecskip}{\TUL@TOC@skip}%
\renewcommand{\cftbeforesubsubsecskip}{\TUL@TOC@skip}%

% Bezpečné patchování odkazů v TOC
\ifcsdef{l@chapter}{%
    \pretocmd{\l@chapter}{\hypersetup{linkcolor=\TUL@TOCtextcolor}}{}{}%
}{}%
\ifcsdef{l@section}{%
    \pretocmd{\l@section}{\hypersetup{linkcolor=\TUL@TOCtextcolor}}{}{}%
}{}%
\ifcsdef{l@subsection}{%
    \pretocmd{\l@subsection}{\hypersetup{linkcolor=\TUL@TOCtextcolor}}{}{}%
}{}%

% ==========================================================================
% Nastavení vzhledu popisků (Figures, Tables)
% ==========================================================================

\AtBeginDocument{%
    \ifthenelse{\boolean{TUL@figcapsleft}}{%
        \captionsetup[figure]{justification=raggedright,singlelinecheck=false}%
    }{%
        \captionsetup[figure]{justification=centering,singlelinecheck=false}%
    }%
    \ifthenelse{\boolean{TUL@tabcapsleft}}{%
        \captionsetup[table]{justification=raggedright,singlelinecheck=false}%
    }{%
        \captionsetup[table]{justification=centering,singlelinecheck=false}%
    }%
    \ifthenelse{\boolean{TUL@nocapnumbers}}{%
        \captionsetup{labelformat=empty}%
    }{}%
    \@ifundefined{chapter}{}{%
        \ifthenelse{\boolean{TUL@singlecapnumbers}}{%
            \@removefromreset{figure}{chapter}%
            \renewcommand{\thefigure}{\arabic{figure}}%
            \@removefromreset{table}{chapter}%
            \renewcommand{\thetable}{\arabic{table}}%
        }{}%
    }%
}%

% ==========================================================================
% Nastavení zarovnání obrázků / tabulek (včetně popisků)
% POZNÁMKA: Bloky kódu mají také svoji option, ta ale mění jen boolean
% pro jejich popisky (kód nemá cenu centrovat)
% ==========================================================================

% Hook do kernelu LaTeXu - robustní řešení pro všechny plovoucí objekty
\g@addto@macro\@floatboxreset{%
  % Kontrola, zda jsme uvnitř plovoucího objektu s definovaným typem
  \ifx\@captype\undefined%
  \else
    % Zarovnání obrázků (figure)
    \ifthenelse{\equal{\@captype}{figure}}{%
      \ifthenelse{\boolean{TUL@figuresleft}}{}{\centering}%
    }{}%
    % Zarovnání tabulek (table)
    \ifthenelse{\equal{\@captype}{table}}{%
      \ifthenelse{\boolean{TUL@tablesleft}}{}{\centering}%
    }{}%
  \fi
}

% ==========================================================================
% Definice seznamů obrázků a tabulek
% ==========================================================================

\setlength{\cftfigindent}{0pt}%
\setlength{\cfttabindent}{0pt}%
\renewcommand{\cftfigaftersnum}{:}%
\renewcommand{\cfttabaftersnum}{:}%

\AtBeginDocument{%
    \ifthenelse{\equal{\TUL@nguage}{EN}}{%
        \renewcommand{\cftfigpresnum}{Figure }%
        \renewcommand{\cfttabpresnum}{Table }%
        \setlength{\cftfignumwidth}{5.6em}%
        \setlength{\cfttabnumwidth}{5.1em}%
    }{%
        \renewcommand{\cftfigpresnum}{Obrázek }%
        \renewcommand{\cfttabpresnum}{Tabulka }%
        \setlength{\cftfignumwidth}{6.6em}%
        \setlength{\cfttabnumwidth}{6.1em}%
    }%
    \renewcommand{\listoffigures}{%
        \phantomsection%
        \ifthenelse{\equal{\TUL@nguage}{EN}}{%
            \section*{\LARGE List of Figures}%
            \@mkboth{List of Figures}{List of Figures}%
            \addcontentsline{toc}{chapter}{List of Figures}%
        }{%
            \section*{\LARGE Seznam obrázků}%
            \@mkboth{Seznam obrázků}{Seznam obrázků}%
            \addcontentsline{toc}{chapter}{Seznam obrázků}%
        }%
        \vspace{0.35em}\thispagestyle{plain}%
        {\hypersetup{linkcolor=\TUL@TOCtextcolor}\@starttoc{lof}}\par\vspace{1em}%
    }%
    \renewcommand{\listoftables}{%
        \phantomsection%
        \ifthenelse{\equal{\TUL@nguage}{EN}}{%
            \section*{\LARGE List of Tables}%
            \@mkboth{List of Tables}{List of Tables}%
            \addcontentsline{toc}{chapter}{List of Tables}%
        }{%
            \section*{\LARGE Seznam tabulek}%
            \@mkboth{Seznam tabulek}{Seznam tabulek}%
            \addcontentsline{toc}{chapter}{Seznam tabulek}%
        }%
        \vspace{0.35em}\thispagestyle{plain}%
        {\hypersetup{linkcolor=\TUL@TOCtextcolor}\@starttoc{lot}}\par\vspace{1em}%
    }%
}%

% ==========================================================================
% Seznam zkratek (Abbreviations)
% ==========================================================================

\ifcsdef{abbreviations}{}{%
    \newenvironment{abbreviations}{%
        \phantomsection%
        \ifthenelse{\equal{\TUL@nguage}{EN}}{%
            \section*{\LARGE List of abbreviations}%
            \addcontentsline{toc}{chapter}{List of abbreviations}%
        }{%
            \section*{\LARGE Seznam zkratek}%
            \addcontentsline{toc}{chapter}{Seznam zkratek}%
        }%
        \vspace{-1em}\thispagestyle{plain}%
        \DefTblrTemplate{contfoot-text}{default}{}%
        \DefTblrTemplate{conthead-text}{default}{}%
        \DefTblrTemplate{contfoot}{default}{}%
        \DefTblrTemplate{conthead}{default}{}%
        \DefTblrTemplate{caption}{default}{}%
        \DefTblrTemplate{capcont}{default}{}%
        \noindent\begin{tblr}[long, entry=none]{column{2}={co=1}}%
    }{%
        \end{tblr}\vspace{1em}%
    }%
}%

% ==========================================================================
% Výpisy kódů (Listings)
% ==========================================================================

\fvset{
    breaklines=true,
    breakanywhere=false,
    breakafter={,;./-\_},
    breakbefore={},
    breakautoindent=true
}
\RecustomVerbatimEnvironment{verbatim}{Verbatim}{}%

% --- Seznam zdrojových kódů (LOL) ---
\providecommand{\listoflistings}{%
    \phantomsection%
    \ifthenelse{\equal{\TUL@nguage}{EN}}{%
        \section*{\LARGE List of Listings}%
        \@mkboth{List of Listings}{List of Listings}%
        \addcontentsline{toc}{chapter}{List of Listings}%
    }{%
        \section*{\LARGE Seznam zdrojových kódů}%
        \@mkboth{Seznam zdrojových kódů}{Seznam zdrojových kódů}%
        \addcontentsline{toc}{chapter}{Seznam zdrojových kódů}%
    }%
    \vspace{0.85em}\thispagestyle{plain}%
    {\hypersetup{linkcolor=\TUL@TOCtextcolor}\@starttoc{lol}}\par\vspace{1em}%
}%

% --- Formát řádku v LOL ---
\providecommand{\l@tullisting}{%
    \ifthenelse{\equal{\TUL@nguage}{EN}}%
        {\@dottedtocline{0}{0pt}{6.1em}}%
        {\@dottedtocline{0}{0pt}{9.0em}}%
}%

% --- Čítač výpisů ---
\ifcsdef{c@tullisting}{}{%
    \@ifundefined{chapter}{%
        \newcounter{tullisting}%
        \renewcommand{\thetullisting}{\arabic{tullisting}}%
    }{%
        \ifthenelse{\boolean{TUL@singlecapnumbers}}{%
            \newcounter{tullisting}%
            \renewcommand{\thetullisting}{\arabic{tullisting}}%
        }{%
            \newcounter{tullisting}[chapter]%
            \renewcommand{\thetullisting}{\thechapter.\arabic{tullisting}}%
        }%
    }%
}%

% --- Popisek výpisu ---
\providecommand{\TUL@listing@prefix}{Zdrojový~kód}%
\AtBeginDocument{%
    \ifthenelse{\equal{\TUL@nguage}{EN}}{%
        \renewcommand{\TUL@listing@prefix}{Listing}%
    }{%
        \renewcommand{\TUL@listing@prefix}{Zdrojový~kód}%
    }%
}%

\providecommand{\listingcaption}[1]{%
    \par\vspace{-8pt}\refstepcounter{tullisting}%
    \addcontentsline{lol}{tullisting}{%
        \protect\numberline{\TUL@listing@prefix~\thetullisting:}#1%
    }%
    \ifthenelse{\boolean{TUL@lstcapsleft}}{%
        {\raggedright\noindent%
            \ifthenelse{\boolean{TUL@nocapnumbers}}{%
                #1%
            }{%
                \TUL@listing@prefix~\thetullisting: #1%
            }%
        \par}%
    }{%
        {\centering%
            \ifthenelse{\boolean{TUL@nocapnumbers}}{%
                #1%
            }{%
                \TUL@listing@prefix~\thetullisting: #1%
            }%
        \par}%
    }%
    \par\vspace{8pt}%
}%

% --- Prostředí pro výpisy ---
\newenvironment{tulquote}{%
    \begin{list}{}{%
        \setlength\leftmargin{\parindent}%
        \setlength\topsep{0pt}%
        \setlength\partopsep{0pt}%
        \setlength\parsep{0pt}%
        \setlength\itemsep{0pt}%
    }%
    \item[]%
}{%
    \end{list}%
}%

\newenvironment{listing}{%
    \par\addvspace{0pt}%
    \begin{tulquote}%
        \color{\tulcolor}%
        \raggedright\sloppy%
        \def\FrameCommand##1{##1}%
        \MakeFramed{}{\setlength{\hsize}{\linewidth}\advance\hsize-\width\FrameRestore}%
        \par\nobreak\noindent\ignorespaces%
}{%
        \endMakeFramed%
    \end{tulquote}%
    \par\addvspace{6pt}%
}%

\newenvironment{slisting}{%
    \par\addvspace{6pt}%
    \begin{tulquote}\footnotesize%
        \color{\tulcolor}\raggedright\sloppy%
        \def\FrameCommand##1{\hspace{10pt}##1}%
        \MakeFramed{}{\setlength{\hsize}{\linewidth}\advance\hsize-\width\FrameRestore}%
        \par\nobreak\noindent\ignorespaces%
}{%
        \endMakeFramed%
    \end{tulquote}%
    \par\addvspace{6pt}%
}%

\newenvironment{linelisting}{%
    \par\addvspace{6pt}%
    \begin{tulquote}\footnotesize%
        \color{\tulcolor}\raggedright\sloppy%
        \def\FrameCommand##1{\hspace{0pt}{\color{\tulcolor}\vrule width 1.0pt}\hspace{10pt}##1}%
        \MakeFramed{}{\setlength{\hsize}{\linewidth}\advance\hsize-\width\FrameRestore}%
        \par\nobreak\noindent\ignorespaces%
}{%
        \endMakeFramed%
    \end{tulquote}%
    \par\addvspace{6pt}%
}%

% ==========================================================================
% Titulní strany
% ==========================================================================

\providecommand{\create@uthb@x}[2]{\vspace{20mm}{\Large #1}\\\vspace{5mm}{\large #2}\par}%

% Výpočet velikosti
\ifcsdef{f@ntsize}{}{%
    \newlength{\f@ntsize}%
}%
\setlength{\f@ntsize}{\f@size pt}%

\providecommand{\TULtitlepage}[3]{{%
    \thispagestyle{TULheaderonly}\mbox{}\vfill\vfill\vfill\bgroup\raggedright%
    \color{\tulcolor}\huge\TULFancyFontBold\setlength{\baselineskip}{2.5\f@ntsize} #1\par%
    \create@uthb@x{#2}{#3}\egroup\vfill\newpage%
}}%

\providecommand{\TULfancytitlepage}[3]{{%
    \thispagestyle{TULheaderonly}\pagecolor{\tulcolor}\darkTULbg\mbox{}\vfill\vfill\vfill\bgroup\raggedright%
    \color{white}\huge\TULFancyFont\setlength{\baselineskip}{2.5\f@ntsize} #1\par%
    \create@uthb@x{#2}{#3}\egroup\vfill\newpage\pagecolor{white}%
}}%

% ==========================================================================
% Formátování nadpisů (Sections)
% ==========================================================================

\providecommand{\setup@TUL@titleformats}{%
    \def\setupTitleFormat##1##2##3##4{%
        \ifthenelse{\boolean{TUL@numbering}}%
        {\titleformat{##1}{\color{\titlecolor}\TUL@headfnt##2\raggedright}{##3}{1em}{}}%
        {\titleformat{##1}{\color{\titlecolor}\TUL@headfnt##2\raggedright}{}{0pt}{}}%
    }%
    \ifcsname chapter\endcsname\setupTitleFormat{\chapter}{\LARGE}{\thechapter}{}\fi % chktex 1
    \ifcsname section\endcsname\setupTitleFormat{\section}{\Large}{\thesection}{}\fi % chktex 1
    \ifcsname subsection\endcsname\setupTitleFormat{\subsection}{\large}{\thesubsection}{}\fi % chktex 1
    \ifcsname subsubsection\endcsname\setupTitleFormat{\subsubsection}{\normalsize}{\thesubsubsection}{}\fi % chktex 1
    \ifcsname paragraph\endcsname\titleformat{\paragraph}{\color{\titlecolor}\TUL@headfnt\normalsize\raggedright}{}{0pt}{}\fi % chktex 1
}%
